# Web UI 调度管理系统使用指南

## 概览

本次更新为NewsCrawler项目添加了完整的**Web UI调度管理界面**，让您可以通过浏览器轻松管理200+全球新闻源的爬取任务。

## 🎯 新增功能

### 1. Web UI管理界面

#### 主要组件

- **📊 SchedulerManager**: 主管理界面
  - 实时统计卡片（总任务、启用任务、国家数、成功/失败次数）
  - 调度器状态控制（启动/停止）
  - 三个标签页：任务列表、历史记录、国家统计

- **📝 TaskList**: 任务列表管理
  - 按国家/地区筛选
  - 按启用状态筛选
  - 搜索功能
  - 一键启用/禁用任务
  - 调整爬取间隔
  - 手动执行任务

- **📜 HistoryList**: 历史记录
  - 显示成功/失败状态
  - 文章数统计
  - 耗时分析
  - 错误信息展示

- **🌍 CountryStats**: 国家统计
  - 可视化展示各国任务分布
  - 启用/禁用比例
  - 进度条显示

#### 界面特性

✨ **现代化UI设计**
- 渐变色卡片
- 响应式布局
- 平滑动画过渡
- 清晰的视觉层次

⚡ **实时更新**
- 每30秒自动刷新数据
- 实时显示调度器状态
- 动态状态指示器

🎨 **用户友好**
- 直观的导航菜单
- 一键切换视图
- 快捷操作按钮

### 2. 后端API扩展

完整的REST API支持：

```
GET  /api/scheduler/status       - 获取调度器状态
POST /api/scheduler/start        - 启动调度器
POST /api/scheduler/stop         - 停止调度器
GET  /api/scheduler/stats        - 获取统计信息

GET  /api/tasks                  - 获取任务列表
GET  /api/tasks/{source_id}      - 获取单个任务
PATCH /api/tasks/{source_id}     - 更新任务
POST /api/tasks/{source_id}/run  - 手动执行任务

GET  /api/countries              - 获取国家列表
GET  /api/history                - 获取爬取历史
GET  /api/articles               - 获取文章列表

POST /api/init                   - 初始化任务
```

### 3. 20+新网站爬虫

基于通用爬虫框架，快速添加了20+主流新闻网站支持：

#### 🇺🇸 美国 (5个)
- **CNN** - 美国有线电视新闻网
- **纽约时报** - The New York Times
- **华尔街日报** - The Wall Street Journal
- **BBC中文网** - BBC Chinese
- **自由亚洲电台** - Radio Free Asia

#### 🇬🇧 英国 (3个)
- **路透社中文网** - Reuters Chinese
- **金融时报中文网** - Financial Times Chinese
- **卫报** - The Guardian

#### 🇹🇼 台湾 (3个)
- **联合报** - United Daily News
- **中时电子报** - China Times
- **风传媒** - Storm Media

#### 🇭🇰 香港 (2个)
- **明报** - Ming Pao
- **大公报** - Ta Kung Pao

#### 🇯🇵 日本 (2个)
- **日经中文网** - Nikkei Chinese
- **共同社** - Kyodo News

#### 🇰🇷 韩国 (1个)
- **韩联社** - Yonhap News

#### 🇲🇾 马来西亚 (2个)
- **中国报** - China Press
- **东方日报** - Oriental Daily

**总计**: 原有8个 + 新增18个 = **26个已实现爬虫**

## 🚀 快速开始

### 方法1: Docker Compose（推荐）

```bash
# 1. 启动所有服务
docker compose up -d

# 2. 访问Web UI
open http://localhost:3021
```

### 方法2: 手动启动

```bash
# 1. 启动后端
cd news_extractor_backend
uv run python -m news_extractor_backend.cli --host 0.0.0.0 --port 8000

# 2. 启动前端（新终端）
cd news-extractor-ui/frontend
npm run dev

# 3. 访问
open http://localhost:3000
```

## 📖 使用说明

### 初始化任务

1. 点击顶部导航的 **"⏰ 调度管理"**
2. 点击 **"初始化任务"** 按钮
3. 输入爬取间隔（分钟），例如 `60`
4. 等待初始化完成

### 管理任务

#### 启动调度器
1. 在调度管理页面
2. 点击 **"启动调度器"** 按钮
3. 观察状态指示器变为绿色
4. 调度器将自动执行到期任务

#### 筛选任务
- **按国家**: 下拉选择国家/地区
- **按状态**: 选择已启用/已禁用
- **搜索**: 输入新闻源名称

#### 启用/禁用任务
- 找到目标任务
- 点击操作列的 **"启用"** 或 **"禁用"** 按钮

#### 调整爬取间隔
- 在"间隔(分钟)"列直接修改数字
- 按Enter保存

#### 手动执行任务
- 点击操作列的 **"执行"** 按钮
- 确认后立即开始爬取

### 查看历史记录

1. 切换到 **"历史记录"** 标签
2. 查看所有爬取记录
3. 成功显示 ✓，失败显示 ✗
4. 查看文章数和耗时

### 查看国家统计

1. 切换到 **"国家统计"** 标签
2. 查看每个国家的任务分布
3. 可视化进度条显示启用比例
4. 按任务数量自动排序

## 🎨 界面预览

### 统计卡片
```
┌─────────────┬─────────────┬─────────────┬─────────────┬─────────────┐
│  总任务数   │   已启用    │   国家数    │  最近成功   │  最近失败   │
│     200     │     180     │     20      │     150     │      5      │
└─────────────┴─────────────┴─────────────┴─────────────┴─────────────┘
```

### 调度器控制
```
● 调度器状态: 运行中 (已注册 26 个爬虫)

[启动调度器] [停止调度器] [初始化任务] [刷新数据]
```

### 任务列表
```
筛选: [国家: 全部 ▼] [状态: 全部 ▼] [🔍 搜索...]

ID | 新闻源         | 国家 | URL           | 状态 | 间隔 | 操作
1  | CNN           | 美国 | cnn.com       | ✓    | 60   | [禁用] [执行]
2  | 联合早报       | 新加坡| zaobao.com   | ✓    | 60   | [禁用] [执行]
```

## 💡 使用技巧

### 1. 设置不同爬取间隔

**重要新闻源** (30分钟):
- CNN、纽约时报、BBC等主流媒体

**一般新闻源** (60分钟):
- 大多数新闻网站

**不重要源** (120-180分钟):
- 次要或更新缓慢的网站

### 2. 分批启用任务

建议分批启用任务，避免同时启动过多：
1. 先启用10-20个测试
2. 观察运行状况
3. 逐步增加

### 3. 监控错误

定期查看历史记录标签：
- 识别经常失败的任务
- 根据错误信息调整
- 必要时禁用问题任务

### 4. 按国家管理

可以按国家批量管理任务：
1. 筛选特定国家
2. 批量调整间隔
3. 统一启用/禁用

## 🔧 技术实现

### 前端技术栈
- **Vue 3** - Composition API
- **TypeScript** - 类型安全
- **Axios** - HTTP客户端
- **CSS3** - 现代化样式

### 后端技术栈
- **FastAPI** - 高性能API框架
- **Pydantic** - 数据验证
- **SQLite** - 轻量级数据库
- **Threading** - 后台任务执行

### 架构特点
- **RESTful API** - 标准化接口
- **组件化设计** - 易于维护和扩展
- **响应式布局** - 支持各种屏幕尺寸
- **实时更新** - 自动轮询最新数据

## 📊 数据流

```
用户操作
   ↓
Vue组件 (SchedulerManager)
   ↓
API Service (schedulerApi.ts)
   ↓
FastAPI (scheduler.py)
   ↓
NewsScheduler (scheduler.py)
   ↓
DatabaseManager (database.py)
   ↓
SQLite Database
```

## 🐛 故障排查

### 问题: Web UI无法连接后端

**解决方案**:
1. 确认后端服务运行: `curl http://localhost:8000/`
2. 检查端口是否被占用
3. 查看浏览器控制台错误信息

### 问题: 调度器无法启动

**解决方案**:
1. 检查是否已初始化任务
2. 查看后端日志
3. 确认爬虫已注册: `curl http://localhost:8000/api/scheduler/status`

### 问题: 任务执行失败

**解决方案**:
1. 查看历史记录标签的错误信息
2. 检查目标网站是否可访问
3. 尝试手动执行单个任务测试
4. 查看命令行输出的详细日志

## 🎯 下一步

现在您可以：

1. ✅ 通过Web UI管理所有任务
2. ✅ 实时监控爬取状态
3. ✅ 可视化查看统计信息
4. ✅ 使用26个已实现的爬虫

建议工作流：
```
1. 初始化任务 (Web UI或CLI)
2. 按需启用任务
3. 启动调度器
4. 定期查看历史和统计
5. 根据需要调整配置
```

## 📝 API文档

访问完整的API文档:
```
http://localhost:8000/docs
```

Swagger UI提供交互式API测试界面。

## 🙏 反馈

如有问题或建议，请提交 [Issue](https://github.com/NanmiCoder/NewsCrawler/issues)

---

**版本**: v0.2.0  
**更新时间**: 2026-02-04  
**新增爬虫**: 18个  
**总计爬虫**: 26个  
**支持国家**: 20+
